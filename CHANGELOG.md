# 更新日志 (Changelog)

本项目的所有重大更改都将记录在此文件中。

## [0.2.1] - 2026-01-31
- 修复侧批渲染顺序，确保显示在丝栏之上 (fix #38)
- 修复侧批跨页时颜色丢失问题 (fix #44)
- 修复标点模式应用于侧批的问题 (fix #39)
- 添加测试用例验证 issue #41 已在重构中修复 (fix #41)
- 实现通用颜色注册机制，统一 jiazhu、sidenote、decorate 组件的颜色处理
- 引入样式栈 (Style Stack) 架构，支持多属性 (字体、字号、颜色) 的统一管理
- 将夹注迁移至样式栈，提升跨页渲染的一致性

## [0.2.0] - 2026-01-31
本次发布没有新的功能或修复bug。调整为全新架构，将来可以更快的进行开发。
- 重构代码架构，引入全局状态表统一管理配置参数
- 引入插件架构，将 sidenote、judou、textbox、banxin、decorate 模块重构为标准化插件
- 提取独立设置命令：\contentSetup, \pageSetup, \jiazhuSetup, \judouSetup, \sidenoteSetup, \pizhuSetup 等
- 重组模块目录结构，将相关功能移至 guji/、banxin/、core/ 等命名空间
- 重构调试模块，采用 get_debugger 模式统一日志输出
- 大规模代码清理：移除冗余参数传递，合并渲染函数，优化布局计算逻辑

## [0.1.6] - 2026-01-29
- 修复网格布局分列时的溢出偏置及跨列缩进丢失问题 (fix #32)
- 优化字体加载逻辑，支持更灵活的字体补全 (fix #33)
- 实现章节标题 (\chapter) 在正文环境中的动态更新与渲染
- 增加 \newpage 和 \clearpage 强制分页支持，并自动处理版心避让
- 增强夹注（双行小字）功能，支持单行命令及手动分行控制 (fix #22)
- 实现段落悬挂缩进功能 (fix #27)
暂时不再添加新功能。下一个版本会进行一定代码重构，并更新到v0.2.0。

## [0.1.5] - 2026-01-28
- 新增多字体递补链功能及一套中文化字体设置命令 (fix #23)
- 实现 \装饰 和 \改 功能，支持垂直排版校勘标记 (fix #12)
- 文本框支持垂直压缩以适配网格位置 (fix #24)
- 修复了维度解析 0pt 报错、句读位置偏移、长标题挤压等布局 Bug (fix #19, #20)
- 引入基于 PDF 渲染对比的回归测试自动化程序
- 重构渲染核心逻辑并提升整体代码稳定性

## [0.1.4] - 2026-01-27
- 添加了句读功能
- 修复了段落缩进、侧批换列的一些问题
- 对code进行了大量重构，更加易于理解和维护
- 添加更多testfile

## [0.1.3] - 2026-01-25
- 修复分页不准确、页码位置的问题
- 批注坐标更加准确，且会跳过版心位置防止被截断
- 完整排版了《红楼梦甲戌本》第一回
- 更加符合Expl3 语法
- 添加了 l3build testfile 进行回归测试
- 建立了完善的 Lua 单元测试框架，支持 `l3build test` 命令
- 彻底修复了单元测试中的 Mock 逻辑与 API 不一致问题

## [0.1.2] - 2026-01-22
- src 重命名为 tex
- 彻底修复了Windows下CRLF，BOM 字符问题
- 采用l3build，详见 build.lua
- 修复package require 路径，确保 release 的版本解压即用。

## [0.1.1] - 2026-01-19

### 功能
- 增加了批注命令，底层仍是可悬浮文本框。

### 修复
- 修复了CRLF，BOM 在Windows下字符问题

### 文档
- 更新了文档，中英双语。

## [0.1.0] - 2026-01-18

### 主要功能
- **原生几何垂直排版引擎**：基于 Lua 深度定制，专为古籍排版设计的网格布局系统。
- **古籍核心元素支持**：完整支持版心 (Banxin)、鱼尾 (Yuwei)、乌丝栏/朱丝栏等传统装帧元素。
- **完善的注释系统**：提供灵活的夹注 (双行小字) 和侧批 (Sidenote/眉批) 功能。
- **开箱即用的模板系统**：预设《四库全书》、《红楼梦甲戌本》等多种传统书籍视觉风格。
- **跨平台字体自动检测**：智能识别 Windows、macOS 和 Linux 系统字体，无需繁琐配置。
- **电子简策/筒子页支持**：支持传统“筒子页”逻辑及电子阅览适配。
- **绝对定位印章系统**：支持在页面任意位置覆盖馆藏印/私印，模拟古籍实物感。

### 项目支撑
- 自动化的 CTAN 打包与发布流程。
- 详尽的中英文用户手册及多个经典古籍复现示例。
