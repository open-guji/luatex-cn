# 更新日志 (Changelog)

本项目的所有重大更改都将记录在此文件中。

## [0.2.7] - 2026-02-09
新增现代排版支持：(部分完成 #34)
- 新增现代标点符号系统：标点分类、禁则处理、标点挤压、大陆/台湾位置风格
- 新增脚注系统、自然排版(非严格网格、底端对齐)
- 新增中华书局模板
- 新增示例《史记·秦楚之际月表》
古籍功能提升：
- 新增书名页功能 (fix #28)
重构与修复：
- 修复列满自动翻页后 \newpage 导致内容丢失的问题 (fix #63)
- 修复 \Space 命令列首空格被跳过的问题 (fix #62)
- 修复 \挪抬 命令尾部空格产生额外空白

## [0.2.6] - 2026-02-07
新增对抬头的全面支持：
- 新增抬头命令体系：\抬头[N]、\单抬、\双抬、\三抬，支持挪抬/空抬/相对抬头
- 新增 \平抬 命令，用于古籍文本格式化
- 新增夹注不自动平衡模式 (auto-balance=false)
- 修复抬头后文字挤压和换列问题
- 修复抬头命令外边框阶梯状边框问题
重新实现下划线：
- 专名号/书名号改用 PDF 画线实现，解决字体强关联和连接问题 (fix #53, #56, #57)
- 专名号/书名号支持侧批、夹注、文本框环境
其他：
- 修复夹注换列逻辑
- 修复侧批跨页颜色泄漏问题
请通过 Wiki 查看最新用法

## [0.2.5] - 2026-02-05
- 新增目录条目命令 \条目，支持层级缩进，方便目录排版
- 新增列、末列命令，更好控制排版 (fix #30)
- 修复专名号/书名号在行末最后一个字上未绘制的问题 (fix #54)
- 修复部分字符（如"漢"）居中偏移问题，正文改用宽度居中 (fix #55)
- 修复侧批跨页时颜色泄漏导致版心染色的问题 (fix #48)

## [0.2.4] - 2026-02-03
- 新增下划线支持，使用 | 字符实现 (fix #5)
- 新增书名号、专名号支持 (fix #16)
- 修复侧批换列位置对齐问题 (fix #47)
- 修复侧批换页走到第二列的问题 (fix #49)
- 修复夹注对齐问题 (fix #51)
- 修复 \newgeometry 不支持 paperwidth/paperheight 的问题 (fix #52)

## [0.2.3] - 2026-02-01
- 新增眉批命令 \眉批，支持自动排版和手动指定坐标 (fix #46)
- 新增特殊文本格式 TextBox frame 功能，支持边框形状设置 (fix #25)
- 新增出版商显示功能，在版心下方显示，字体可自定义 (fix #26)
- 修复批注和文本框错误继承段落缩进的问题 (fix #37)
- 修复眉批跨页时显示在错误页面的问题
- 修复字体检测支持简繁体中文名称 (fix #35)
- 重构边框样式系统，引入样式栈管理 border、outer_border 等属性

## [0.2.2] - 2026-01-31
- 修复 preamble 中定义的 \chapter 不显示在首页版心的问题 (fix #45)
- 修复夹注在列末尾时错误跳到下一列的问题 (fix #42)
- 修复句读模式支持更多中文标点符号 (fix #40)
- 新增调试标尺功能，显示页面网格坐标 (fix #31)
- 浮动框调试坐标现在会根据 \显示坐标[measure=...] 设置显示对应单位 (cm/pt/mm)
- 将 core/luatex-cn-core-metadata 添加到核心包依赖

## [0.2.1] - 2026-01-31
- 修复侧批渲染顺序，确保显示在丝栏之上 (fix #38)
- 修复侧批跨页时颜色丢失问题 (fix #44)
- 修复标点模式应用于侧批的问题 (fix #39)
- 添加测试用例验证 issue #41 已在重构中修复 (fix #41)
- 实现通用颜色注册机制，统一 jiazhu、sidenote、decorate 组件的颜色处理
- 引入样式栈 (Style Stack) 架构，支持多属性 (字体、字号、颜色) 的统一管理
- 将夹注迁移至样式栈，提升跨页渲染的一致性

## [0.2.0] - 2026-01-31
本次发布没有新的功能或修复bug。调整为全新架构，将来可以更快的进行开发。
- 重构代码架构，引入全局状态表统一管理配置参数
- 引入插件架构，将 sidenote、judou、textbox、banxin、decorate 模块重构为标准化插件
- 提取独立设置命令：\contentSetup, \pageSetup, \jiazhuSetup, \judouSetup, \sidenoteSetup, \pizhuSetup 等
- 重组模块目录结构，将相关功能移至 guji/、banxin/、core/ 等命名空间
- 重构调试模块，采用 get_debugger 模式统一日志输出
- 大规模代码清理：移除冗余参数传递，合并渲染函数，优化布局计算逻辑

## [0.1.6] - 2026-01-29
- 修复网格布局分列时的溢出偏置及跨列缩进丢失问题 (fix #32)
- 优化字体加载逻辑，支持更灵活的字体补全 (fix #33)
- 实现章节标题 (\chapter) 在正文环境中的动态更新与渲染
- 增加 \newpage 和 \clearpage 强制分页支持，并自动处理版心避让
- 增强夹注（双行小字）功能，支持单行命令及手动分行控制 (fix #22)
- 实现段落悬挂缩进功能 (fix #27)
暂时不再添加新功能。下一个版本会进行一定代码重构，并更新到v0.2.0。

## [0.1.5] - 2026-01-28
- 新增多字体递补链功能及一套中文化字体设置命令 (fix #23)
- 实现 \装饰 和 \改 功能，支持垂直排版校勘标记 (fix #12)
- 文本框支持垂直压缩以适配网格位置 (fix #24)
- 修复了维度解析 0pt 报错、句读位置偏移、长标题挤压等布局 Bug (fix #19, #20)
- 引入基于 PDF 渲染对比的回归测试自动化程序
- 重构渲染核心逻辑并提升整体代码稳定性

## [0.1.4] - 2026-01-27
- 添加了句读功能
- 修复了段落缩进、侧批换列的一些问题
- 对code进行了大量重构，更加易于理解和维护
- 添加更多testfile

## [0.1.3] - 2026-01-25
- 修复分页不准确、页码位置的问题
- 批注坐标更加准确，且会跳过版心位置防止被截断
- 完整排版了《红楼梦甲戌本》第一回
- 更加符合Expl3 语法
- 添加了 l3build testfile 进行回归测试
- 建立了完善的 Lua 单元测试框架，支持 `l3build test` 命令
- 彻底修复了单元测试中的 Mock 逻辑与 API 不一致问题

## [0.1.2] - 2026-01-22
- src 重命名为 tex
- 彻底修复了Windows下CRLF，BOM 字符问题
- 采用l3build，详见 build.lua
- 修复package require 路径，确保 release 的版本解压即用。

## [0.1.1] - 2026-01-19

### 功能
- 增加了批注命令，底层仍是可悬浮文本框。

### 修复
- 修复了CRLF，BOM 在Windows下字符问题

### 文档
- 更新了文档，中英双语。

## [0.1.0] - 2026-01-18

### 主要功能
- **原生几何垂直排版引擎**：基于 Lua 深度定制，专为古籍排版设计的网格布局系统。
- **古籍核心元素支持**：完整支持版心 (Banxin)、鱼尾 (Yuwei)、乌丝栏/朱丝栏等传统装帧元素。
- **完善的注释系统**：提供灵活的夹注 (双行小字) 和侧批 (Sidenote/眉批) 功能。
- **开箱即用的模板系统**：预设《四库全书》、《红楼梦甲戌本》等多种传统书籍视觉风格。
- **跨平台字体自动检测**：智能识别 Windows、macOS 和 Linux 系统字体，无需繁琐配置。
- **电子简策/筒子页支持**：支持传统“筒子页”逻辑及电子阅览适配。
- **绝对定位印章系统**：支持在页面任意位置覆盖馆藏印/私印，模拟古籍实物感。

### 项目支撑
- 自动化的 CTAN 打包与发布流程。
- 详尽的中英文用户手册及多个经典古籍复现示例。
