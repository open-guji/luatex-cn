% cn_vertical_minimal.sty
% Minimal version - Step by step testing
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cn_vertical_minimal}[2026/01/12 v0.1 Minimal Test]

\typeout{==== Loading cn_vertical_minimal ====}

% Check LuaTeX
\RequirePackage{ifluatex}
\ifluatex\else
  \PackageError{cn_vertical_minimal}{Requires LuaTeX}{}
\fi

% Load luatexbase for attributes
\RequirePackage{luatexbase}
\newluatexattribute\cnverticalindent
\newluatexattribute\cnverticalrightindent

\typeout{==== Step 1: Loading Lua code directly ====}

% Step 1: Load all Lua code in ONE block
\directlua{
  -- Clear cache
  package.loaded["cn_vertical_constants"] = nil
  package.loaded["cn_vertical_flatten"] = nil
  package.loaded["cn_vertical_layout"] = nil
  package.loaded["cn_vertical_render"] = nil
  package.loaded["cn_vertical"] = nil

  -- Load constants
  dofile("cn_vertical_constants.lua")
}

\typeout{==== Step 2: Testing constants are loaded ====}

% Test that constants exist
\directlua{
  if cn_vertical_constants then
    texio.write_nl("SUCCESS: cn_vertical_constants module loaded")
    texio.write_nl("  - HLIST_NODE = " .. tostring(cn_vertical_constants.HLIST_NODE))
    texio.write_nl("  - VLIST_NODE = " .. tostring(cn_vertical_constants.VLIST_NODE))
  else
    texio.write_nl("ERROR: cn_vertical_constants is nil!")
  end
}

\typeout{==== Step 3: Defining simple test command ====}

% Simple test command - just show the text
\newcommand{\VerticalTest}[1]{%
  \directlua{texio.write_nl("VerticalTest called with: " .. "\luaescapestring{#1}")}%
  \par\noindent #1\par
}

\typeout{==== cn_vertical_minimal loaded successfully ====}


\endinput
